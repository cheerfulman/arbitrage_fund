## 修改计划

### 1. 修改表结构

#### `ai_analyses` 表
- **新增字段**：`nav_dt VARCHAR(20) COMMENT '净值日期'`
- **用途**：存储基金的净值日期

#### `funds` 表
- **新增字段**：`date DATE COMMENT '数据插入日期'`
- **用途**：存储当前插入数据的日期

### 2. 修改代码逻辑

#### `db_utils.py`
1. **修改 `create_tables` 方法**
   - 更新 `ai_analyses` 表创建语句，添加 `nav_dt` 字段
   - 更新 `funds` 表创建语句，添加 `date` 字段

2. **修改 `save_funds` 方法**
   - 在 `INSERT` 语句中添加 `date` 字段
   - 在 VALUES 中添加当前日期作为 `date` 值

3. **修改 `save_ai_analysis` 方法**
   - 在 `INSERT` 语句中添加 `nav_dt` 字段
   - 在参数列表中添加 `nav_dt` 参数

#### `main.py`
1. **修改 `run_analysis` 函数**
   - 在调用 `save_ai_analysis` 时传入 `nav_dt` 参数
   - 确保 `nav_dt` 参数从基金数据中正确获取

2. **修改 `get_ai_analyses` 函数**
   - 在查询结果中包含 `nav_dt` 字段
   - 在返回的 JSON 数据中包含 `nav_dt` 字段

### 3. 测试修改后的代码

1. **重启 Docker 服务**：确保修改后的代码生效
2. **手动触发基金分析任务**：生成新的测试数据
3. **测试 API 接口**：验证修改后的功能是否正常

### 4. 预期效果

- `ai_analyses` 表将包含 `nav_dt` 字段，存储基金的净值日期
- `funds` 表将包含 `date` 字段，存储数据插入日期
- API 接口将返回包含 `nav_dt` 字段的完整分析数据
- 整个系统的逻辑将更加清晰，数据关系更加明确

### 5. 技术要点

- 确保数据库连接设置了正确的时区，避免时间偏差
- 确保唯一索引和约束仍然有效
- 保持代码的向后兼容性
- 确保所有调用处都传入了正确的参数
- 进行充分的测试，确保修改后的功能正常