# 修改data_list排序逻辑

## 1. 问题分析

### 1.1 当前情况
- `data_list` 是一个包含基金分析结果的列表
- 每个元素是一个字典，包含 `discount_rt` 字段（折扣率）
- 当前代码直接返回 `data_list`，没有进行排序

### 1.2 用户需求
- 按照 `discount_rt` 字段进行降序排序
- 确保排序正确处理字符串到浮点数的转换
- 处理可能的空值或非数字值

### 1.3 技术考虑
- `discount_rt` 字段可能是字符串类型（例如 "-1.23%"）
- 需要去除百分号并转换为浮点数进行排序
- 需要处理空值或非数字值的情况
- 排序应该在构建完整的 `data_list` 之后，返回之前进行

## 2. 解决方案

### 2.1 方案
- 在返回 `data_list` 之前添加排序逻辑
- 使用 `sorted()` 函数和自定义排序键
- 处理 `discount_rt` 字段的转换和异常情况

## 3. 实施步骤

### 3.1 修改main.py文件
1. 在构建完 `data_list` 之后，返回之前添加排序代码
2. 实现自定义排序键函数，处理 `discount_rt` 字段的转换
3. 使用 `sorted()` 函数进行降序排序
4. 更新返回的 `data` 字段为排序后的列表

## 4. 具体修改

### 4.1 修改main.py文件

在 `data_list` 构建完成后，返回之前添加以下代码：

```python
# 按照discount_rt降序排序
def get_discount_rt_value(item):
    """获取discount_rt的数值用于排序"""
    discount_rt = item.get('discount_rt', '')
    if not discount_rt:
        return -float('inf')  # 空值排在最后
    try:
        # 去除百分号并转换为浮点数
        return float(discount_rt.replace('%', ''))
    except (ValueError, AttributeError):
        return -float('inf')  # 非数字值排在最后

data_list = sorted(data_list, key=get_discount_rt_value, reverse=True)
```

然后修改返回语句：

```python
return {
    "status": "success",
    "date": date,
    "count": len(data_list),  # 使用排序后的长度
    "data": data_list
}
```

## 5. 预期效果

- `data_list` 按照 `discount_rt` 字段的数值进行降序排序
- 折扣率高的基金排在前面
- 空值或非数字值的基金排在最后
- 排序结果正确反映基金的折扣率情况

## 6. 注意事项

- 确保 `discount_rt` 字段的格式处理正确
- 考虑异常情况，避免排序过程中出现错误
- 保持代码的可读性和可维护性